<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI P5.js Code Generator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load p5.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/p5.min.js"></script>
    <!-- Load custom styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-6 text-center">
            <h1 class="text-3xl font-extrabold text-gray-900">AI p5.js Creative Coder</h1>
            <p class="text-gray-500">Chat with Gemini to generate live p5.js sketches.</p>
        </header>

        <div id="loading-container" class="text-center py-4" style="display: none;">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-t-blue-500 border-blue-200"></div>
            <p class="text-gray-600 mt-2">Generating sketch...</p>
        </div>

        <div id="app-container" class="grid grid-cols-1 md:grid-cols-2 gap-8 h-[70vh] md:h-[80vh] bg-white rounded-xl shadow-2xl p-4 md:p-6">
            
            <!-- Chat Interface -->
            <div class="flex flex-col h-full">
                <div id="chat-history" class="flex-grow overflow-y-auto space-y-4 pr-2">
                    <!-- Initial AI message -->
                    <div class="flex justify-start">
                        <div class="chat-bubble-ai max-w-xs md:max-w-md p-3">
                            Hello! I'm ready to write some p5.js code for you. Tell me what kind of sketch you'd like to see, and I'll generate the code and run it live!
                            <div class="text-xs text-gray-400 mt-1">User ID: <span id="user-id-display">Loading...</span></div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="mt-4 pt-4 border-t border-gray-200">
                    <form id="chat-form" class="flex space-x-3">
                        <input type="text" id="user-input" class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 'Draw a rotating colorful spiral'">
                        <button type="submit" id="send-button" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-150 ease-in-out disabled:bg-blue-300">
                            Send
                        </button>
                    </form>
                </div>
            </div>

            <!-- Canvas and Code Display Area -->
            <div class="flex flex-col h-full bg-gray-50 rounded-lg shadow-inner p-2 space-y-4">
                <h2 class="text-xl font-bold text-gray-800 border-b pb-2">Live Canvas Output</h2>
                <div id="canvas-container" class="flex-grow w-full overflow-hidden flex items-center justify-center min-h-[150px] bg-gray-200 rounded-lg">
                    <p class="text-gray-500 text-center">Your p5.js sketch will appear here.</p>
                </div>
                
                <h2 class="text-xl font-bold text-gray-800 border-b pb-2">Generated Code</h2>
                <pre id="code-display" class="code-block flex-grow overflow-auto text-sm">
// The p5.js code body generated by the AI will be displayed here.
</pre>
            </div>
        </div>
    </div>

    <!-- Modals for Clipboard and Error -->
    <div id="clipboard-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <p class="text-green-600 font-semibold text-center">Code copied to clipboard!</p>
        </div>
    </div>

    <div id="error-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full">
            <h3 class="text-xl font-bold text-red-600 mb-3">Execution Error</h3>
            <p class="text-gray-700" id="error-message"></p>
            <button onclick="document.getElementById('error-modal').classList.add('opacity-0', 'pointer-events-none')" class="mt-4 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg">
                Close
            </button>
        </div>
    </div>

    <!-- Main application entry point -->
    <script type="module" src="app.js"></script>
</body>
</html>